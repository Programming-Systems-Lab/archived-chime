<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN"
            "http://www.w3.org/TR/REC-html40/loose.dtd">
<html lang="en">
<head>
<title>Siena C++ API Documentation</title>
<meta http-equiv="Reply-to" content="carzanig@cs.colorado.edu">
<meta http-equiv="Owner" content="Antonio Carzaniga">
<meta name="Author" content="Antonio Carzaniga">
<link href="antodoc.css" rel="stylesheet" type="text/css">
<link rev=MADE href="mailto:carzanig@cs.colorado.edu">
</head>
<body>
<div align=right><em><a
href="http://www.cs.colorado.edu/~carzanig/siena/index.html">Siena</a></em>
C++ API documentation (v. 0.4.1)</div>
<hr>
<!-- Generated by Doxygen 1.2.8.1 -->
<center>
<a class="qindex" href="index.html">Main Page</a> &nbsp; <a class="qindex" href="hierarchy.html">Class Hierarchy</a> &nbsp; <a class="qindex" href="annotated.html">Compound List</a> &nbsp; <a class="qindex" href="files.html">File List</a> &nbsp; <a class="qindex" href="functions.html">Compound Members</a> &nbsp; <a class="qindex" href="examples.html">Examples</a> &nbsp; </center>
<hr><h1>subscriber.cc</h1>
<p>
This is an example of how to program a simple subscriber application. To compile this example on a GNU/Linux system or on other Unix-like systems, assuming Siena has been installed in $prefix, execute:
<p>
<pre>
 c++ subscriber.cc -o subscriber -I$prefix/include -L$prefix/lib -lsiena
 </pre>
<p>
On some platforms (notably Solaris), you will have to link additional libraris (e.g., -lsocket -lnsl).
<p>

<p>
To compile this example on a win32 system, using Visual C++, assuming Siena has been installed in %prefix%, execute:
<p>
<pre>
 cl -I%prefix% -GX -c subscriber.cc
 link -out:subscriber subscriber.obj %prefix%\siena.lib wsock32.lib
 </pre>
<p>
<div class="fragment"><pre><font class="comment">// -*- C++ -*-</font>
<font class="comment">//</font>
<font class="comment">//  This file is part of Siena, a wide-area event notification system.</font>
<font class="comment">//  See http://www.cs.colorado.edu/serl/siena/</font>
<font class="comment">//</font>
<font class="comment">//  Author: Antonio Carzaniga &lt;carzanig@cs.colorado.edu&gt;</font>
<font class="comment">//  See the file AUTHORS for full details. </font>
<font class="comment">//</font>
<font class="comment">//  Copyright (C) 1998-2001 University of Colorado</font>
<font class="comment">//</font>
<font class="comment">//  This program is free software; you can redistribute it and/or</font>
<font class="comment">//  modify it under the terms of the GNU General Public License</font>
<font class="comment">//  as published by the Free Software Foundation; either version 2</font>
<font class="comment">//  of the License, or (at your option) any later version.</font>
<font class="comment">//</font>
<font class="comment">//  This program is distributed in the hope that it will be useful,</font>
<font class="comment">//  but WITHOUT ANY WARRANTY; without even the implied warranty of</font>
<font class="comment">//  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</font>
<font class="comment">//  GNU General Public License for more details.</font>
<font class="comment">//</font>
<font class="comment">//  You should have received a copy of the GNU General Public License</font>
<font class="comment">//  along with this program; if not, write to the Free Software</font>
<font class="comment">//  Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA 02111-1307,</font>
<font class="comment">//  USA, or send email to serl@cs.colorado.edu.</font>
<font class="comment">//</font>
<font class="comment">// $Id$</font>
<font class="comment">//</font>
<font class="preprocessor">#include &lt;string.h&gt;</font>
<font class="preprocessor">#include &lt;stdlib.h&gt;</font>

<font class="preprocessor">#include &lt;iostream&gt;</font>
<font class="preprocessor">#include &lt;exception&gt;</font>
                                                <font class="comment">// include Siena headers</font>
<font class="preprocessor">#include &lt;siena/Siena.h&gt;</font>
<font class="preprocessor">#include &lt;siena/ThinClient.h&gt;</font>

<font class="keyword">static</font> <font class="keywordtype">void</font> print_usage(<font class="keyword">const</font> <font class="keywordtype">char</font> * progname)<font class="keyword"> </font>{
    cerr &lt;&lt; <font class="stringliteral">"usage: "</font> &lt;&lt; progname 
         &lt;&lt; <font class="stringliteral">" [-udp] [-port &lt;num&gt;] [-host &lt;host&gt;] &lt;uri-master&gt;"</font> &lt;&lt; endl;
}

<font class="keywordtype">int</font> main (<font class="keywordtype">int</font> argc, <font class="keywordtype">char</font> *argv[])<font class="keyword"></font>
<font class="keyword"></font>{
    <font class="keywordtype">bool</font> udp = <font class="keyword">false</font>;
    <font class="keywordtype">unsigned</font> <font class="keywordtype">short</font> port = 1969;
    <font class="keyword">const</font> <font class="keywordtype">char</font> * master = NULL;
    <font class="keyword">const</font> <font class="keywordtype">char</font> * thishost = NULL;
    
    <font class="keywordflow">try</font> {
        <font class="keywordtype">int</font> i;
        <font class="keywordflow">for</font>(i=1; i &lt; argc; ++i) {               <font class="comment">// parse cmd-line params</font>
            <font class="keywordflow">if</font>(strcmp(argv[i], <font class="stringliteral">"-udp"</font>)==0) {
                udp = <font class="keyword">true</font>;
            } <font class="keywordflow">else</font> <font class="keywordflow">if</font> (strcmp(argv[i], <font class="stringliteral">"-port"</font>)==0) {
                <font class="keywordflow">if</font> (++i &lt; argc) {
                    port = atoi(argv[i]);
                } <font class="keywordflow">else</font> {
                    print_usage(argv[0]);
                    <font class="keywordflow">return</font> 1;
                }
            } <font class="keywordflow">else</font> <font class="keywordflow">if</font> (strcmp(argv[i], <font class="stringliteral">"-host"</font>)==0) {
                <font class="keywordflow">if</font> (++i &lt; argc) {
                    thishost = argv[i];
                } <font class="keywordflow">else</font> {
                    print_usage(argv[0]);
                    <font class="keywordflow">return</font> 1;
                }
            } <font class="keywordflow">else</font> {
                master = argv[i];
            }
        }
        <font class="keywordflow">if</font> (master == NULL) {
            print_usage(argv[0]);
            <font class="keywordflow">return</font> 1;
        }

        <a name="_a0"></a><a class="code" href="classThinClient.html">ThinClient</a> siena(master);               <font class="comment">// create interface to</font>
        <a name="_a1"></a><a class="code" href="classReceiver.html">Receiver</a> * r;                           <font class="comment">// given master server</font>
        <font class="keywordflow">if</font> (udp) {
            r = <font class="keyword">new</font> UDPReceiver(port, thishost);<font class="comment">// create receiver for </font>
        } <font class="keywordflow">else</font> {                                <font class="comment">// this interface</font>
            r = <font class="keyword">new</font> TCPReceiver(port, thishost);
        }
        siena.<a name="a2"></a><a class="code" href="classThinClient.html#a2">set_receiver</a>(r);                  <font class="comment">// set receiver</font>

        <a name="_a3"></a><a class="code" href="classFilter.html">Filter</a> f;                               <font class="comment">// create subscription filter</font>
        f.<a name="a4"></a><a class="code" href="classFilter.html#a3">add_constraint</a>(<font class="stringliteral">"stock"</font>, SX_eq, <font class="stringliteral">"XYZ"</font>);
        f.<a class="code" href="classFilter.html#a3">add_constraint</a>(<font class="stringliteral">"price"</font>, SX_lt, (<font class="keywordtype">long</font>)100);
        siena.<a name="a5"></a><a class="code" href="classThinClient.html#a5">subscribe</a>(f);                     <font class="comment">// subscribe</font>

        <a name="_a6"></a><a class="code" href="classNotification.html">Notification</a> * n;

        <font class="keywordflow">for</font> (i = 1; i &lt; 20; ++i) {              <font class="comment">// read incoming notifications</font>
            n = siena.<a name="a7"></a><a class="code" href="classThinClient.html#a8">get_notification</a>();
            <font class="keywordflow">if</font> (n != NULL)  {
                cout &lt;&lt; <font class="stringliteral">"stock="</font> &lt;&lt; (*n)[<font class="stringliteral">"stock"</font>].string_value()
                     &lt;&lt; <font class="stringliteral">" price="</font> &lt;&lt; (*n)[<font class="stringliteral">"price"</font>].int_value() &lt;&lt; endl;
                <font class="keyword">delete</font>(n);
            }
        }
        siena.<a name="a8"></a><a class="code" href="classThinClient.html#a7">unsubscribe</a>();                    <font class="comment">// unsubscribe and shutdown </font>
        siena.<a name="a9"></a><a class="code" href="classThinClient.html#a12">shutdown</a>();                       <font class="comment">// interface</font>
        <font class="keyword">delete</font>(r);
    } <font class="keywordflow">catch</font> (exception &amp;ex) {
        cout &lt;&lt; <font class="stringliteral">"error: "</font> &lt;&lt; ex.what() &lt;&lt; endl;
    }
    <font class="keywordflow">return</font> 0;
}
</pre></div><hr>
Copyright &#169; 2001  University of Colorado.
<br>
<small>Permission is granted to copy, distribute and/or modify this
document under the terms of the GNU Free Documentation License,
Version 1.1 or any later version published by the Free Software
Foundation; with no Invariant Sections, no Front-Cover Texts and no
Back-Cover Texts.  A copy of the license is included in the section
entitled <a href="fdl.txt">"GNU Free Documentation License"</a>.
This documentation is authored and maintained by 
<a href="http://www.cs.colorado.edu/~carzanig/">Antonio
Carzaniga</a></small>
</body></html>
